# Описание тестов и инструкция по запуску

Этот файл описывает существующие тесты в репозитории и шаги для локального запуска.

Кратко:

- Файлы с тестами находятся в папке `tests/`.
- Основные тесты: `tests/test_main.py`, `tests/test_mqtt_client.py`.

Подготовка окружения:

1. Создайте и активируйте виртуальное окружение (рекомендуется):

```bash
python3 -m venv .venv
source .venv/bin/activate
```

2. Установите пакет проекта в режиме разработки и pytest:

```bash
pip install -e .
pip install pytest
pip install legacy-cgi

```

Запуск тестов:

- Запустить все тесты:

```bash
pytest -q
```

- Запустить тесты в конкретном файле:

```bash
pytest tests/test_mqtt_client.py -q
```

Параметры полезные при отладке:

- `-q` — компактный вывод;
- `-s` — не подавлять вывод в stdout/stderr (полезно для отладочных print/log);
- `-k <expr>` — запуск тестов, имена которых соответствуют выражению `expr`;
- `--maxfail=1` — остановить после первой неудачи.

Покрытие (опционально):

```bash
pip install coverage
coverage run -m pytest
coverage report -m
```

Особенности, которые стоит учесть:

- Некоторые тесты могут требовать наличия MQTT-брокера или внешних сервисов. Если тесты для `mqtt_client` интеграционные и требуют реального брокера, можно поставить локальный Mosquitto:

```bash
# на Debian/Ubuntu
sudo apt update && sudo apt install -y mosquitto
sudo systemctl start mosquitto
```

- Однако большинство модульных тестов используют мокирование и не требуют реальных сетевых подключений. В случае неясностей смотрите тесты в `tests/` — они показывают ожидания и используемую конфигурацию.

Полезные команды CI-стиля:

```bash
# компактный запуск в CI
pytest --maxfail=1 --disable-warnings -q
```

