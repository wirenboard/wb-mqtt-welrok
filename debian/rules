#!/usr/bin/make -f
#
# Build Debian package using https://github.com/spotify/dh-virtualenv
#
# The below targets create a clean copy of the workdir via
# using "sdist", else "pip" goes haywire when installing from
# sourcedir ".", because that includes the debian build stage,
# and a recursive explosion ensues when symlinks are followed.
#
# It also ensures your MANIFEST is complete and at least covers
# all files needed for a release build.

# Increase trace logging, see debhelper(7) (uncomment to enable)
#DH_VERBOSE=1

export PYBUILD_NAME=wb_welrok

.PHONY: clean override_dh_auto_clean override_dh_strip

clean:
	dh $@

%:
	dh $@ --with systemd --buildsystem=pybuild

override_dh_auto_clean:
	# Skip auto clean to avoid pyversions error

override_dh_strip:
	dh_strip --exclude=cffi --exclude=_imaging

override_dh_auto_install:
	dh_auto_install
	find debian/wb-welrok -type d -name __pycache__ -exec rm -rf {} +
	dh_systemd_enable || true
	dh_systemd_start || true
